var m=(b,r,f)=>new Promise((x,w)=>{var a=i=>{try{t(f.next(i))}catch(l){w(l)}},s=i=>{try{t(f.throw(i))}catch(l){w(l)}},t=i=>i.done?x(i.value):Promise.resolve(i.value).then(a,s);t((f=f.apply(b,r)).next())});var v=({dbName:b,store:r,autoIncrement:f,keyPath:x,version:w,uint8Array:a})=>{let s=typeof window.indexedDB!="undefined";s||console.error("[nano-indexed] [Error] Your browser not have indexedDB, Now use localStorage.");let t;a&&(typeof TextDecoder=="undefined"||typeof TextEncoder=="undefined"||!s)&&(a=!1);let i,l;a&&(i=new TextEncoder,l=new TextDecoder);let p=()=>new Promise(o=>{if(t)o(void 0);else{let e=window.indexedDB.open(b,w);e.onerror=console.error,e.onsuccess=n=>{t||(t=n.target.result),o(void 0)},e.onupgradeneeded=function(n){t||(t=n.target.result),t.createObjectStore(r,{autoIncrement:f,keyPath:x})}}}),S={set:(o,e)=>m(void 0,null,function*(){return s?(t||(yield p()),a&&(typeof e!="string"?e=i.encode(JSON.stringify(e)):e=i.encode(e)),new Promise(n=>{if(t.objectStoreNames.contains(r)){let d=t.transaction([r],"readwrite").objectStore(r),g=o?d.put(e,o):d.put(e);g.onerror=u=>{console.error(u),n(void 0)},g.onsuccess=n}else n(void 0)})):new Promise((n,c)=>{localStorage.setItem((o||1).toString(),JSON.stringify(e)),n(void 0)})}),update:(o,e)=>m(void 0,null,function*(){let n=yield S.get(o);if(!n)return yield S.set(o,e),e;let c=Object.assign(Object.assign({},n),e);return yield S.set(o,c),c}),get:o=>m(void 0,null,function*(){return s?(t||(yield p()),new Promise(e=>{if(t.objectStoreNames.contains(r)){let d=t.transaction([r]).objectStore(r).get(o);d.onsuccess=function(g){let u=g.target.result;if(a){u=l.decode(u);try{u=JSON.parse(u)}catch(y){}}e(u)}}else e(void 0)})):new Promise(e=>{let n=localStorage.getItem((o||1).toString());if(n)try{n=JSON.parse(n)}catch(c){}e(n)})}),remove:o=>m(void 0,null,function*(){return s?(t||(yield p()),new Promise(e=>{if(t.objectStoreNames.contains(r)){let d=t.transaction([r],"readwrite").objectStore(r).delete(o);d.onerror=g=>{console.error(g),e(void 0)},d.onsuccess=e}else e(void 0)})):new Promise(e=>{localStorage.removeItem((o||1).toString()),e(void 0)})})};return S};export{v as NanoIndexed};
