var m=(b,r,l)=>new Promise((x,S)=>{var s=a=>{try{t(l.next(a))}catch(f){S(f)}},i=a=>{try{t(l.throw(a))}catch(f){S(f)}},t=a=>a.done?x(a.value):Promise.resolve(a.value).then(s,i);t((l=l.apply(b,r)).next())});var p=({dbName:b,store:r,autoIncrement:l,keyPath:x,version:S,uint8Array:s})=>{let i=!1;i||console.error("[nano-indexed] [Error] Your browser not have indexedDB, Now use localStorage.");let t;s&&(typeof TextDecoder=="undefined"||typeof TextEncoder=="undefined"||!i)&&(s=!1);let a,f;s&&(a=new TextEncoder,f=new TextDecoder);let v=()=>new Promise(o=>{if(t)o(void 0);else{let e=window.indexedDB.open(b,S);e.onerror=console.error,e.onsuccess=n=>{t||(t=n.target.result),o(void 0)},e.onupgradeneeded=function(n){t||(t=n.target.result),t.createObjectStore(r,{autoIncrement:l,keyPath:x})}}}),w={set:(o,e)=>m(void 0,null,function*(){return i?(t||(yield v()),s&&(typeof e!="string"?e=a.encode(JSON.stringify(e)):e=a.encode(e)),new Promise(n=>{if(t.objectStoreNames.contains(r)){let d=t.transaction([r],"readwrite").objectStore(r),g=o?d.put(e,o):d.put(e);g.onerror=u=>{console.error(u),n(void 0)},g.onsuccess=n}else n(void 0)})):new Promise((n,c)=>{localStorage.setItem((o||1).toString(),JSON.stringify(e)),n(void 0)})}),update:(o,e)=>m(void 0,null,function*(){let n=yield w.get(o);if(!n)return yield w.set(o,e),e;let c=Object.assign(Object.assign({},n),e);return yield w.set(o,c),c}),get:o=>m(void 0,null,function*(){return i?(t||(yield v()),new Promise(e=>{if(t.objectStoreNames.contains(r)){let d=t.transaction([r]).objectStore(r).get(o);d.onsuccess=function(g){let u=g.target.result;if(s){u=f.decode(u);try{u=JSON.parse(u)}catch(y){}}e(u)}}else e(void 0)})):new Promise(e=>{let n=localStorage.getItem((o||1).toString());if(n)try{n=JSON.parse(n)}catch(c){}e(n)})}),remove:o=>m(void 0,null,function*(){return i?(t||(yield v()),new Promise(e=>{if(t.objectStoreNames.contains(r)){let d=t.transaction([r],"readwrite").objectStore(r).delete(o);d.onerror=g=>{console.error(g),e(void 0)},d.onsuccess=e}else e(void 0)})):new Promise(e=>{localStorage.removeItem((o||1).toString()),e(void 0)})})};return w};export{p as NanoIndexed};
