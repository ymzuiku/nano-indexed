var v=Object.defineProperty;var y=Object.getOwnPropertyDescriptor;var D=Object.getOwnPropertyNames;var P=Object.prototype.hasOwnProperty;var N=r=>v(r,"__esModule",{value:!0});var O=(r,t)=>{for(var a in t)v(r,a,{get:t[a],enumerable:!0})},I=(r,t,a,m)=>{if(t&&typeof t=="object"||typeof t=="function")for(let c of D(t))!P.call(r,c)&&(a||c!=="default")&&v(r,c,{get:()=>t[c],enumerable:!(m=y(t,c))||m.enumerable});return r};var j=(r=>(t,a)=>r&&r.get(t)||(a=I(N({}),t,1),r&&r.set(t,a),a))(typeof WeakMap!="undefined"?new WeakMap:0);var b=(r,t,a)=>new Promise((m,c)=>{var d=s=>{try{n(a.next(s))}catch(w){c(w)}},u=s=>{try{n(a.throw(s))}catch(w){c(w)}},n=s=>s.done?m(s.value):Promise.resolve(s.value).then(d,u);n((a=a.apply(r,t)).next())});var E={};O(E,{NanoIndexed:()=>T});var T=({dbName:r,store:t,autoIncrement:a,keyPath:m,version:c,uint8Array:d})=>{let u=typeof window.indexedDB!="undefined";u||console.error("[nano-indexed] [Error] Your browser not have indexedDB, Now use localStorage.");let n;d&&(typeof TextDecoder=="undefined"||typeof TextEncoder=="undefined"||!u)&&(d=!1);let s,w;d&&(s=new TextEncoder,w=new TextDecoder);let p=()=>new Promise(i=>{if(n)i(void 0);else{let e=window.indexedDB.open(r,c);e.onerror=console.error,e.onsuccess=o=>{n||(n=o.target.result),i(void 0)},e.onupgradeneeded=function(o){n||(n=o.target.result),n.createObjectStore(t,{autoIncrement:a,keyPath:m})}}}),x={set:(i,e)=>b(void 0,null,function*(){return u?(n||(yield p()),d&&(typeof e!="string"?e=s.encode(JSON.stringify(e)):e=s.encode(e)),new Promise(o=>{if(n.objectStoreNames.contains(t)){let l=n.transaction([t],"readwrite").objectStore(t),S=i?l.put(e,i):l.put(e);S.onerror=g=>{console.error(g),o(void 0)},S.onsuccess=o}else o(void 0)})):new Promise((o,f)=>{localStorage.setItem((i||1).toString(),JSON.stringify(e)),o(void 0)})}),update:(i,e)=>b(void 0,null,function*(){let o=yield x.get(i);if(!o)return yield x.set(i,e),e;let f=Object.assign(Object.assign({},o),e);return yield x.set(i,f),f}),get:i=>b(void 0,null,function*(){return u?(n||(yield p()),new Promise(e=>{if(n.objectStoreNames.contains(t)){let l=n.transaction([t]).objectStore(t).get(i);l.onsuccess=function(S){let g=S.target.result;if(d){g=w.decode(g);try{g=JSON.parse(g)}catch(h){}}e(g)}}else e(void 0)})):new Promise(e=>{let o=localStorage.getItem((i||1).toString());if(o)try{o=JSON.parse(o)}catch(f){}e(o)})}),remove:i=>b(void 0,null,function*(){return u?(n||(yield p()),new Promise(e=>{if(n.objectStoreNames.contains(t)){let l=n.transaction([t],"readwrite").objectStore(t).delete(i);l.onerror=S=>{console.error(S),e(void 0)},l.onsuccess=e}else e(void 0)})):new Promise(e=>{localStorage.removeItem((i||1).toString()),e(void 0)})})};return x};module.exports=j(E);
